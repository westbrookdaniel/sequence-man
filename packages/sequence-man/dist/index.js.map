{"version":3,"sources":["../src/index.tsx","../src/useManager.tsx","../src/repeat.tsx","../src/animate.tsx"],"sourcesContent":["export * from \"./useManager\";\nexport * from \"./repeat\";\nexport * from \"./animate\";\n","import * as React from \"react\";\nimport create from \"zustand\";\nimport { raf } from \"@react-spring/rafz\";\n\ninterface Store {\n  scenes: Scene[];\n  sceneIndex: number;\n  paused: boolean;\n  view: JSX.Element;\n  currentScene: Generator<JSX.Element, void> | null;\n  shouldLoop: boolean;\n  setConfig: (config: Config) => void;\n  next: () => void;\n  pause: () => void;\n  play: () => void;\n}\n\ntype Scene = () => Generator<JSX.Element, void>;\n\ninterface Config {\n  scenes: Scene[];\n  shouldLoop?: boolean;\n}\n\nconst useStore = create<Store>((set) => ({\n  scenes: [],\n  sceneIndex: 0,\n  view: <></>,\n  currentScene: null,\n  paused: false,\n  shouldLoop: false,\n  setConfig: (config: Config) => {\n    const scenes = config.scenes ?? [];\n    const shouldLoop = config.shouldLoop ?? false;\n    set((s) => {\n      const currentScene = scenes[0]?.();\n      if (s.currentScene || !currentScene) {\n        return {\n          scenes,\n          shouldLoop,\n          currentScene: s.currentScene,\n          view: s.view,\n        };\n      } else {\n        return {\n          scenes,\n          shouldLoop,\n          currentScene,\n          view: currentScene.next().value ?? s.view,\n        };\n      }\n    });\n  },\n  next: () => {\n    set((s) => {\n      if (s.paused) return s;\n\n      const result = s.currentScene?.next();\n      if (!result) return s;\n\n      if (result.done) {\n        let nextSceneIndex = s.sceneIndex + 1;\n        let nextScene = s.scenes[nextSceneIndex]?.();\n\n        if (!nextScene && s.shouldLoop) {\n          nextSceneIndex = 0;\n          nextScene = s.scenes[0]?.();\n        }\n        if (!nextScene) return s;\n\n        const nextResult = nextScene.next();\n        return {\n          sceneIndex: nextSceneIndex,\n          currentScene: nextScene,\n          view: nextResult.value ?? s.view,\n        };\n      } else {\n        return {\n          sceneIndex: s.sceneIndex,\n          currentScene: s.currentScene,\n          view: result.value,\n        };\n      }\n    });\n  },\n  pause: () => set({ paused: true }),\n  play: () => set({ paused: false }),\n}));\n\nexport function useController() {\n  return useStore((s) => ({\n    pause: s.pause,\n    play: s.play,\n    paused: s.paused,\n    next: s.next,\n  }));\n}\n\nexport function usePause() {\n  const { pause, play, paused } = useController();\n\n  React.useEffect(() => {\n    pause();\n    return () => play();\n  }, [pause, play]);\n\n  return { play, paused };\n}\n\nexport function useManager(config: Config) {\n  const setConfig = useStore((s) => s.setConfig);\n  const next = useStore((s) => s.next);\n  const view = useStore((s) => s.view);\n\n  React.useEffect(() => {\n    setConfig(config);\n  }, [config, setConfig]);\n\n  return { view, next };\n}\n\nexport function useFrameManager(config: Config) {\n  const { view, next } = useManager(config);\n\n  React.useEffect(() => {\n    function frame() {\n      next();\n      return true;\n    }\n    raf(frame);\n    return () => raf.cancel(frame);\n  }, [next]);\n\n  return { view };\n}\n","export function* repeat(frames: number, element: JSX.Element) {\n  for (let i = 1; i <= frames; i++) {\n    yield element;\n  }\n}\n","import * as React from \"react\";\nimport { useSpring, animated, UseSpringProps } from \"@react-spring/web\";\nimport { usePause } from \"./useManager\";\n\nexport interface AnimatableProps {\n  style: React.CSSProperties;\n}\n\nexport type Animatable = React.ComponentType<AnimatableProps>;\n\nexport function Animate({\n  element,\n  springProps,\n  noPlay,\n}: {\n  element: Animatable;\n  springProps: UseSpringProps;\n  noPlay?: boolean;\n}) {\n  const AnimatedElement = React.useMemo(() => animated(element), [element]);\n\n  const { play, paused } = usePause();\n\n  const props = useSpring({\n    ...springProps,\n    onResolve: () => !noPlay && play(),\n    pause: !paused,\n  });\n\n  return <AnimatedElement style={props} />;\n}\n\nexport function* animate(\n  key: string,\n  element: Animatable,\n  springProps: UseSpringProps\n) {\n  yield <Animate key={key} element={element} springProps={springProps} />;\n}\n"],"mappings":"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","names":[]}